# Updates - October 16, 2025

## Summary
Enhanced the study plan generation to include:
1. **AI-based section mapping** - Uses Claude to intelligently map topics to textbook sections
2. **Real Khan Academy links** - AI generates actual Khan Academy URLs
3. **Textbook pages as REQUIREMENT** - Always includes textbook page ranges when available
4. **Combined resources** - Study plan shows BOTH textbook pages AND Khan Academy resources

## Key Changes

### 1. New AI-Based Section Mapper (`app/services/section_mapper.py`)

Created a new service that uses Claude AI to intelligently map course topics to textbook sections.

**Why this is better:**
- Instead of exact keyword matching, AI understands semantic relationships
- Can identify relevant sections even if terminology doesn't match exactly
- Provides confidence levels (high/medium/low) for each mapping
- Handles the 716 sections from your textbook intelligently

**How it works:**
```python
mapper = get_section_mapper()
topic_mappings = await mapper.map_topics_to_sections(
    topics=topic_list,
    textbook_sections=textbook_data['sections'],
    textbook_title=textbook_data['title']
)
```

The AI analyzes section titles like:
- "1.2 Units and Measurement"
- "3.4 Motion with Constant Acceleration"
- "5.1 Newton's First Law"

And maps them to course topics like "Kinematics" or "Forces" based on conceptual understanding, not just keyword matches.

### 2. Real Khan Academy Links

Updated the `get_khan_academy_resources()` function to request actual URLs from Claude:

```python
{
  "type": "khan_academy",
  "title": "Introduction to Kinematics",
  "url": "https://www.khanacademy.org/science/physics/one-dimensional-motion/kinematic-formulas",
  "estimated_minutes": 20
}
```

The AI now provides:
- **Real working URLs** to Khan Academy content
- **Specific titles** for articles and practice exercises
- **Estimated time** for each resource

### 3. Study Plan Structure Changes

**Before:** Study plan had either textbook pages OR Khan Academy resources

**After:** Study plan ALWAYS includes both (when textbook is available):

```json
{
  "step": 1,
  "topic": "Kinematics",
  "priority": "HIGH",
  "current_score": 40,
  "resources": [
    {
      "type": "textbook",
      "source": "University Physics",
      "section_number": "2.3",
      "section_title": "Motion with Constant Acceleration",
      "page_start": 45,
      "page_end": 52,
      "page_count": 8,
      "estimated_minutes": 40
    },
    {
      "type": "khan_academy",
      "title": "Kinematic Equations",
      "url": "https://www.khanacademy.org/science/physics/...",
      "estimated_minutes": 20
    }
  ],
  "estimated_minutes": 60
}
```

### 4. Updated Workflow Display

Terminal output now shows:

```
Step 1: Kinematics [HIGH PRIORITY]
  Current Score: 40%

  üìö Resources:

    üìñ TEXTBOOK: University Physics
       Section 2.3: Motion with Constant Acceleration
       Pages: 45-52 (8 pages)
       Time: ~40 minutes

    üåê KHAN ACADEMY: Kinematic Equations
       URL: https://www.khanacademy.org/science/physics/...
       Time: ~20 minutes

  ‚è±  Total Time for Topic: 60 minutes
```

### 5. Updated Text Export Format

The exported `.txt` study plan file now clearly shows both resource types:

```
STEP 1: KINEMATICS
Priority: HIGH
Current Score: 40%
----------------------------------------------------------------------

STUDY RESOURCES:

üìñ TEXTBOOK READING:
  Textbook: University Physics
  Section: 2.3 - Motion with Constant Acceleration
  Pages: 45-52 (8 pages)
  Time: ~40 minutes

üåê KHAN ACADEMY:
  Title: Kinematic Equations
  URL: https://www.khanacademy.org/science/physics/one-dimensional-motion/...
  Time: ~20 minutes

‚è±  Total Time for This Topic: 60 minutes
```

## Files Modified

1. **`app/services/section_mapper.py`** (NEW)
   - AI-based topic-to-section mapping
   - Semantic understanding instead of keyword matching
   - Confidence scoring for matches

2. **`test_interactive_workflow.py`**
   - Added `get_khan_academy_resources()` helper function
   - Completely rewrote `generate_study_plan()` to combine resources
   - Updated section mapping to use AI-based mapper
   - Enhanced display to show both textbook and Khan Academy

3. **`app/utils/text_export.py`**
   - Updated `export_study_plan_as_text()` to handle new resource structure
   - Shows textbook pages and Khan Academy links clearly
   - Better formatting with emojis and clear sections

## How the Complete Workflow Now Works

1. **User provides syllabus** ‚Üí Topics extracted
2. **User provides textbook PDF** ‚Üí 716 sections parsed via header detection
3. **AI maps topics to sections** ‚Üí Intelligent matching with confidence levels
4. **Diagnostic survey generated** ‚Üí Yes/No questions for each topic
5. **User answers questions** ‚Üí Identifies weak topics (<60%)
6. **Study plan generated** ‚Üí For each weak topic:
   - AI finds relevant textbook sections (3-10 page ranges)
   - AI provides real Khan Academy links
   - Both combined into comprehensive study resources
7. **Verification quiz created** ‚Üí 10 questions on weak topics
8. **Everything exported** ‚Üí Formatted text files with user's name

## Testing Instructions

Run the updated workflow:

```bash
cd /home/dennis/Projects/reTeach/backend
source venv/bin/activate
python test_interactive_workflow.py
```

When prompted:
1. Enter your name: `Dennis Freyman`
2. Enter email (optional): `dennis@example.com`
3. Syllabus path: `test_data/syllabi/syllabus.txt`
4. Have textbook? `y`
5. Textbook path: `test_data/textbooks/textbook.pdf`
6. Answer diagnostic questions with y/n
7. Review study plan (now with BOTH textbook pages AND Khan Academy links!)

## Expected Output

You'll see:
- **AI-based mapping**: "Using AI to map topics to textbook sections..."
- **For each weak topic**: "Finding Khan Academy resources..." followed by "Including N textbook section(s)" and "Including N Khan Academy resource(s)"
- **Study plan display**: Both textbook pages and Khan Academy URLs clearly shown
- **Exported files**: `dennis_freyman_study_plan.txt` with complete resources

## Key Benefits

‚úÖ **Textbook pages always included** (your requirement!)
‚úÖ **Real Khan Academy links** (not just titles)
‚úÖ **AI-based semantic mapping** (better than keyword matching)
‚úÖ **Combined resources** (comprehensive study materials)
‚úÖ **Clear formatting** (easy to read and follow)

Ready to test!
